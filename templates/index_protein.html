{% extends "layout.html" %}
{% block content %}



<script>
var gwips_clade = '{{  gwips_clade|safe  }}';
var gwips_org = '{{  gwips_org|safe  }}'; 
var gwips_db = '{{  gwips_db|safe  }}';
var gwips_info = {{  gwips_info|safe  }};
console.log("gwips clade is "+gwips_clade);
</script>






<head>
<link rel= "stylesheet" href= "{{ url_for('static', filename='css/common.css') }}">
<link rel= "stylesheet" href= "{{ url_for('static', filename='css/triplet_periodicity.css') }}">
</head>

<div id="page_heading">
<p><font size="5"><b><u>General Settings</u></b></font></p>
</div>


<div id="spacer">   </div>
<div id="dummy1" class="dummy">
</div>



<div id="sidebar">
    <br/>
    <input type="checkbox" style="opacity:0;" name="noisered" value="noisered" unchecked></input>
    <br/>
    <b>Minimum morpheus score: </b> <a class="whatsthis" href="/tripsviz/help/#Max Read Score">(Whats this?) </a><br>
    <input id="minscore" name="minscore" value="5" ></input>
    <br/>
    <b>Gene/Transcript: </b></tran> <a class="whatsthis" href="/tripsviz/help/#Gene/Transcript">(Whats this?) </a><br>
    <input id="tran" name="transcript" ></input>
    <br/>
    <b>Min Read: </b></tran> <a class="whatsthis" href="/tripsviz/help/#Min Read">(Whats this?) </a><br>
    <input name="minread" value="25" ></input>
    <br/>
    <b>Max Read: </b></tran> <a class="whatsthis" href="/tripsviz/help/#Max Read">(Whats this?) </a><br>
    <input name="maxread" value="150" ></input>
    <br/>
    <b>Offset Direction: </b> <a class="whatsthis" href="/tripsviz/help/#Offset Direction">(Whats this?) </a><br>
    <input type="radio" class = "prime_radio" id="fiveprime" value="fiveprime" name="primetype" checked></input>
    <label for='fiveprime' class='check_label'>5'</label>
    <input type="radio" class="prime_radio" id="threeprime" value="threeprime" name="primetype" unchecked></input>
    <label for='threeprime' class='check_label'>3'</label>
</div>


<div id="transcripts">
    </br></br></br></br>
    <input class="hidden_check" id="line_graph" type="checkbox" name="namelite" value="lite1" checked></input><label for='line_graph' class='checkbox_label'></label> <label for='line_graph' class='padded_label'>Line Graph</label><a class="whatsthis" href="/tripsviz/help/#Line Graph">(Whats this?) </a>
    </br></br>
    <input class="hidden_check" id="ambig_check" type="checkbox" name="ambiguous" value="ambiguous" unchecked></input><label for='ambig_check' class='checkbox_label'></label> <label for='ambig_check' class='padded_label'>Allow ambiguously mapped reads</label> <a class="whatsthis" href="/tripsviz/help/#Allow ambiguously mapped reads">(Whats this?) </a>
    </br></br>
    <input class="hidden_check" id="cov_check" type="checkbox" name="coverage" value="coverage" id="coverageid" unchecked></input> <label for='cov_check' class='checkbox_label'></label> <label for='cov_check' class='padded_label'>Riboseq coverage</label><a class="whatsthis" href="/tripsviz/help/#Riboseq coverage">(Whats this?) </a>
    </br></br>
    <input class="hidden_check" id="nuc_check"  type="checkbox" name="nucseq" value="nucseq" id="nucseqid" unchecked></input> <label for='nuc_check' class='checkbox_label'></label> <label for='nuc_check' class='padded_label'>Display nucleotide sequence</label>
    </br></br>
    <input class="hidden_check" visibility="visible"  type="checkbox" name="preprocess" value="preprocess" id="preprocessid" unchecked></input> <label for='preprocessid' class='checkbox_label'></label> <label for='preprocessid' class='padded_label'>Noise cancellation</label>
    <!--<input name="minfiles" value="0" ></input> -->
</div>


<div id = "dialog-2" title = "Choose a transcript...">
</div>


<div id = "study_dialog" title = "Study info">
<table></table>
</div>


<div id="studies">
<p><font size="5" align="center"><b><u>Studies</u></b></font></p>
</br>


<button  class="study_button" type="button" onclick='view_study_info()'><b>View study info</b></button>


<table align="center">
<!--<input type="button" onClick=uncheck_all_riboseq() value="Riboseq: Uncheck All Files    " class="button" />-->
<tr id="1">
<td><button class="button" type="button" onclick='uncheck_all_proteomics()'><b>Uncheck All Files</b></button></td>
<td><button class="button" type="button" onclick='check_all_proteomics()'><b>Check All Files</b></button></td>

</tr>

<tr id="2">
<td><button class="button" type="button" onclick="uncheck_study_proteomics()" ><b>Uncheck this study</b> </button></td>
<td><button class="button" type="button" onclick="check_study_proteomics()" ><b>Check this study</b></button></td>

</tr>
</table>

</br></br>

<table align="center" name="studytable" id="studytable" class="studytable">
<tr id="tablerow1">
</tr>
<tr id="tablerow2">
</tr>
<tr id="tablerow3">
</tr>
<tr id="tablerow4">
</tr>
</table>
</br></br>
</div>


<div id="proteomics_files">
</br>
<p><font size="5" align="center"><b><u>Proteomics files</u></b></br></font></p>
</div>





<div id="buttons"></div>


<div id="gwips">
<a href="http://gwips.ucc.ie" id="gwips_link" target="_blank" >
<button class="button centerbutton" type="submit"><b>View on Gwips</b></button>
</a>
</div>

<div class="wrapper"><button class="button" type="button" onclick="changebuttonlink(gwips_info)"  id="query"><b>View Plot</b></button></div>


<div id="loading-div-background">
  <div id="loading-div" class="ui-corner-all" >
    <!-- <img style="height:64px;margin:10px;" src="static/css/images/282.GIF" alt="Loading.."/> -->
    <img style="height:64px;margin:10px;"      src="{{ url_for('static', filename = 'css/images/282.GIF') }}" width="110" height="85" alt="Loading..."/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sofia.css') }}">
    <h3 style="color:gray;font-weight:normal;">Loading....</h3>
  </div>
</div>


<div id="container"></div>












<script type="text/javascript"   src="{{ url_for('static', filename='js/common.js') }}"></script>
<script type="text/javascript">





var proteostudies = {{  proteostudies|safe  }};
var arrayLength = proteostudies.length;
var defaulttran = "{{ default_tran|safe }}";


$(document).keypress(function(e){
    if (e.which == 13){
        $("#query").click();
        }
    });

rownum = 1
rowcount = -1
for (var key in proteostudies) {
    rowcount += 1;
    if (rowcount == 8) {
        rowcount = 0
        rownum += 1
        };
    var radio_study = "<input type='radio' class='study_radio' id='radio"+key+"' name='content_type' value="+key+" /></b></input><label for='radio"+key+"' class='radio_label' >"+key+"</label>";
    addRow(rownum, radio_study)
    var organism = "{{  organism|safe  }}";
    var riboseq_files_div = document.getElementById('proteomics_files');
    var new_show_div = document.createElement(key);
    new_show_div.className = 'show';
    new_show_div.id = "riboseq"+key;
    tablehtml = "<table  class='file_table'  align='center'>"
    second_dict = proteostudies[key];
    
    var i = -1
    for (var filename in second_dict) {
        i = i+1
        desc = second_dict[filename];
        if(i%2 == 0){
            ihtml = "<td><input id='"+filename+"_check' type='checkbox' class='"+key+"' name="+filename+" value='proteoinputfile' checked ></input>    <label for='"+filename+"_check' class='filetable_label'></label> <label for='"+filename+"_check' class='padded_label'><b>"+filename+"</b>:"+desc+"</label>    </td>"
            tablehtml += '<tr id="'+key+'tablerow'+i+'">'+ihtml
            }
        else{
            ihtml = "<td><input id='"+filename+"_check' type='checkbox' class='"+key+"' name="+filename+" value='proteoinputfile' checked ></input>    <label for='"+filename+"_check' class='filetable_label'></label> <label for='"+filename+"_check' class='padded_label'><b>"+filename+"</b>:"+desc+"</label>    </td>"
            tablehtml += ihtml+'</tr> '
            }
        }
    tablehtml += '</table>';  
    new_show_div.innerHTML = tablehtml;    
    riboseq_files_div.appendChild(new_show_div);
   }







       
$("#loading-div-background").css({ opacity: 0.7 });


$(function() {
    $( "#dialog-2" ).dialog({
        autoOpen: false, 
        modal: true,
        minWidth: 800,
        buttons: {
            Submit: function() {//var transcript = document.getElementById("transcript_sel").value();
                                var transcript = document.querySelector('input[name=transcript_sel]:checked').value;
                                console.log("transcript"+transcript);
                                document.getElementById('tran').value = transcript;
                                $(this).dialog("close");
                                $("#query").click();
                                }
            },
        title: "Choose a transcript. . .",
        position: {
            my: "center",
            at: "center"
                }
        });
        $( "#query4" ).click(function() {
            $( "#dialog-2" ).dialog("open");
            });
        });
     

$("#query").click(function() {  
  $("#loading-div-background").show();
  
  $("#container").hide();
  
  var primetype = document.querySelector('input[name=primetype]:checked').value;
  var transcript = $('input:text[name=transcript]').val();
  var varlite = $('input:checkbox[name=namelite]:checked').val();
  var minread = $('input:text[name=minread]').val();
  var maxread = $('input:text[name=maxread]').val();
  var minscore = $('input:text[name=minscore]').val();
  var minfiles = 0    //$('input:text[name=minfiles]').val();
  var ribocoverage = $('input:checkbox[name=coverage]:checked').val();
  var nucseq = $('input:checkbox[name=nucseq]:checked').val();
  var preprocess = $('input:checkbox[name=preprocess]:checked').val();
  var noisered = $('input:checkbox[name=noisered]:checked').val();
  var ambiguous = $('input:checkbox[name=ambiguous]:checked').val();
  var readscore = $('input:text[name=readscore]').val();
  var organism = "{{  organism|safe  }}";
  var qu = {"minfiles":minfiles,"transcript":transcript, "varlite": varlite, "minread":minread, "maxread":maxread, "minscore":minscore,
            "noisered":noisered,  "ribocoverage": ribocoverage, "ambiguous": ambiguous,"organism":organism,"readscore":readscore, "primetype":primetype,
            "preprocess":preprocess, "nucseq":nucseq};


  var proteostudies = {{  proteostudies|safe  }};
  var arrayLength = proteostudies.length;
  for (var first_key in proteostudies) {
    var second_dict = proteostudies[first_key];
    for (second_key in second_dict) {
        var strname = second_key;
        var newelement=$('input:checkbox[name='+strname+']:checked').val();
        qu[strname] = newelement;}}
  
  $.ajax({
    type: "POST",
    async:true,
    contentType: "application/json; charset=utf-8",
    url: "/proteoquery",
    data: JSON.stringify(qu),
    dataType: "html",
    success: function (data) {
    if (data.slice(0, 11) == "TRANSCRIPTS"){
        var splitdata = data.split(":"); 
        populate_jquery_dialog(splitdata);
        $( "#dialog-2" ).dialog( "open" );
        }
    
    else{
        var graph = $("#container");
        graph.html(data);   
        $("#loading-div-background").hide();      
        $("#container").show();
        $('html, body').animate({scrollTop: $("#container").offset().bottom}, 200);}
        document.getElementById('container').scrollIntoView();
   }});
  
});









document.getElementById('tran').value = defaulttran;











</script>
{% endblock %}
