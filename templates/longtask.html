{% extends "layout.html" %}
{% block content %}
<head>


<link rel= "stylesheet" href= "{{ url_for('static', filename='css/metainfo.css') }}">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-colvis-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/datatables.min.css"/>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-0.12.14.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.14.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-colvis-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/datatables.min.js">
</script>
<title>Flask + Celery Examples</title>
<style>
.progress {
		   width: 100%;
		   text-align: center;
		   }
</style>
</head>
<body>


<div id="loading-div-background">
<div id="loading-div" class="ui-corner-all" >
<img style="height:64px;margin:10px;"      src="{{ url_for('static', filename = 'css/images/282.GIF') }}" width="110" height="85" alt="Loading..."/>
<link rel="stylesheet" href="{{ url_for('static', filename='css/sofia.css') }}">
<h3 id="loading_header" style="color:gray;font-weight:normal;">Loading....</h3>
</div>
</div>








<h2>ORF detection</h2>
<!--<button onclick="start_long_task();">Start Long Calculation</button><br><br>-->
<button id="start-bg-job">Generate Table</button><br><br>
<div id="progress"></div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/nanobar/0.2.1/nanobar.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
    function start_long_task() {
								$("#loading-div-background").show();
								// add task status elements
								div = $('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
								$('#progress').append(div);
								
								// create a progress bar
								var nanobar = new Nanobar({
								   bg: '#44f',
								   target: div[0].childNodes[0]
								   });
								
								// send ajax POST request to start background job
			$.ajax({
				type: 'POST',
				url: '/longtask',
				success: function(data, status, request) {
											  status_url = request.getResponseHeader('Location');
											  update_progress(status_url, nanobar, div[0]);
											  //$("#loading-div-background").hide();
											  },
				error: function() {
					   alert('Unexpected error');
					   }
				});
				}
				function update_progress(status_url, nanobar, status_div) {
					// send GET request to status URL
					$.getJSON(status_url, function(data) {
					// update UI
					percent = parseInt(data['current'] * 100 / data['total']);
					nanobar.go(percent);
					$(status_div.childNodes[1]).text(percent + '%');
					$(status_div.childNodes[2]).text(data['status']);
					$("#loading_header").text(data['status'])
					if (data['state'] != 'PENDING' && data['state'] != 'PROGRESS') {
						if ('result' in data) {
							// show result
							$(status_div.childNodes[3]).text('Result: ' + data['result']);
							$("#loading-div-background").hide();
											}
						else {
						   // something unexpected happened
						   $(status_div.childNodes[3]).text('Result: ' + data['state']);
						   }
																			  }
						else {
						   // rerun in 2 seconds
						   setTimeout(function() {
								update_progress(status_url, nanobar, status_div);
								}, 2000);
						   }
						   });
						   }
				$(function() {
					   $('#start-bg-job').click(start_long_task);
					   });
						   </script>
						   </body>



{% endblock %}

						 